=render partial: 'layouts/new_navbar'
.l-section-small.is-bg-asphalt
  .l-wrap-small
    .container-fluid
      .row
        .col-sm-4.col-md-4
          =link_to library_url do
            .h3.orange.l-margin-bottom-huge
              .fa.fa-arrow-left.bold
                ="Library"

      .row.l-margin-top-big
        .col-md-12
          .col-md-6
            %h1.h1.h-separator.h-separator-left
              =@course.name
            %h6
              =@course.description.to_s.html_safe
          .col-md-6
            .course-info.pull-right
              %h3
                =t('views.subject_courses.show.info')
                -if @course.try(:tutor_id)
                  -if @course.tutor.try(:profile_image_file_name)
                    .profile-single
                      .row
                        .pull-right
                          =image_tag @course.tutor.profile_image.url, class: 'profile-pic profile-pic-small'
                        .pull-left
                          %h1.h1.h-separator.h-separator-left.text-left.l-margin-bottom-big
                            =@course.tutor.full_name

                      -#if @course.tutor_id == 415
                        .box
                          .box-pic
                            =image_tag @course.tutor.profile_image.url, class: 'profile-pic', style: 'margin-bottom: 10px;'
                      -#else
                        =link_to profile_url(@course.tutor), class: 'box'  do
                          .box-pic
                            =image_tag @course.tutor.profile_image.url, class: 'profile-pic', style: 'margin-bottom: 10px;'

                  -else
                    %li.lined-list-item
                      =t('views.general.author')
                      =@course.tutor.try(:full_name)
                  %p{style: 'margin-top: 5px;'}
                    =@course.tutor.try(:first_description).try(:html_safe)



.l-section-small.is-bg-asphalt
  .l-wrap-small
    .container-fluid
      .row
        .col-md-12.l-margin-top-big.l-margin-bottom

          .panel-group#accordion
            %ul.course-topics-list
              -@course.children.all_active.all_in_order.each_with_index do |child, counter|
                %li{role: 'tab', data: {toggle: 'collapse', parent: '#accordion'}, href: "#collapse_#{counter}"}
                  .box-item.lib-panel#headingOne{ aria: {expand: true, controls: "collapse_#{counter}"}, style: "background-color: #{child.is_past_paper ? child.try(:highlight_colour) : ""}"}
                    .box-topic-item
                      =truncate(child.name, length: 50)
                    .time.hidden-xs
                      -if child.quiz_count.to_i > 0
                        -if child.quiz_count.to_i == 1
                          =child.quiz_count.to_s + ' ' + t('views.library.show.mcq')
                        -elsif child.quiz_count.to_i > 1
                          =child.quiz_count.to_s + ' ' + t('views.library.show.mcqs')
                        -if child.video_count > 0
                          |
                      -if child.video_count == 1
                        =#humanize_time(child.video_duration)
                        =child.video_count.to_s + ' ' + t('views.library.show.video')
                      -elsif child.video_count > 1
                        =#humanize_time(child.estimated_time_in_seconds)
                        =child.video_count.to_s + ' ' + t('views.library.show.number_of_videos')

                .panel-collapse.collapse.list-group.l-margin-bottom{id: "collapse_#{counter}", class: (child.id == @child_id ? 'in' : ''), role: 'tabpanel', aria: {labelledby: 'headingOne'} }
                  -child.children.all_in_order.all_active.each do |grandchild|
                    -if current_user
                      =link_to course_special_link(grandchild), class: 'list-group-item link-purple box-topic-item' do
                        .row
                          .col-xs-1.col-sm-1
                            .left-side-meta
                              -if grandchild.completed_by_user_or_guid(current_user.try(:id), current_session_guid)
                                %h5.text-passed{style: 'margin-top: 0px; padding-tight: 0px;'}
                                  %i.glyphicon.glyphicon-check{style: 'font-size: large'}
                              -else
                                %h5{style: 'margin-top: 0px; padding-tight: 0px;'}
                                  %i.glyphicon.glyphicon-unchecked{style: 'font-size: large'}
                          .col-xs-8.col-sm-7{style: 'padding-left: 12px;'}
                            .pull-left
                              =grandchild.name.html_safe
                          .col-xs-12.col-sm-4.hidden-xs
                            .side-meta
                              -if grandchild.is_video
                                -if grandchild.course_module_element_video.try(:duration)
                                  =humanize_time(grandchild.course_module_element_video.duration)
                                -elsif grandchild.try(:estimated_time_in_seconds)
                                  =humanize_time(grandchild.try(:estimated_time_in_seconds))
                              -elsif grandchild.is_quiz
                                =grandchild.number_of_questions.to_s + ' ' + t('views.library.show.questions')
                              -else
                                ='Flash Card'
                    -else
                      =link_to new_student_url, class: 'list-group-item link-purple box-topic-item' do
                        .row
                          .col-xs-1.col-sm-1
                            .left-side-meta
                              -if grandchild.completed_by_user_or_guid(current_user.try(:id), current_session_guid)
                                %h5.text-passed{style: 'margin-top: 0px; padding-tight: 0px;'}
                                  %i.glyphicon.glyphicon-check{style: 'font-size: large'}
                              -else
                                %h5{style: 'margin-top: 0px; padding-tight: 0px;'}
                                  %i.glyphicon.glyphicon-unchecked{style: 'font-size: large'}
                          .col-xs-8.col-sm-7{style: 'padding-left: 12px;'}
                            .pull-left
                              =grandchild.name
                          .col-xs-12.col-sm-4.hidden-xs
                            .side-meta
                              -if grandchild.is_video
                                -if grandchild.try(:course_module_element_video).try(:duration)
                                  =humanize_time(grandchild.course_module_element_video.duration)
                                -elsif grandchild.try(:estimated_time_in_seconds)
                                  =humanize_time(grandchild.try(:estimated_time_in_seconds))
                              -elsif grandchild.is_quiz
                                =grandchild.number_of_questions.to_s + ' ' + t('views.library.show.questions')
                              -else
                                ='Flash Card'


                  -if child.course_module_jumbo_quiz && child.course_module_jumbo_quiz.active
                    -if current_user
                      =link_to course_special_link(child.course_module_jumbo_quiz), class: 'list-group-item link-purple box-topic-item' do
                        .row
                          .col-xs-12.col-sm-8
                            =child.course_module_jumbo_quiz.name
                          .col-xs-12.col-sm-4
                            .side-meta
                              =child.course_module_jumbo_quiz.total_number_of_questions.to_s + ' ' + t('views.library.show.questions')
                    -else
                      =link_to new_student_url, class: 'list-group-item link-purple box-topic-item' do
                        .row
                          .col-xs-12.col-sm-8
                            =child.course_module_jumbo_quiz.name
                          .col-xs-12.col-sm-4
                            .side-meta
                              =child.course_module_jumbo_quiz.total_number_of_questions.to_s + ' ' + t('views.library.show.questions')

              -if @course.question_bank && @course.question_bank.active?
                -if @question_bank_passed
                  -if current_user
                    =link_to course_question_bank_url(@course.name_url, @course.question_bank.id), class: 'final-quiz-box-item lib-panel', style: 'text-decoration: none;' do
                      .box-topic-item
                        =@course.question_bank.name
                      .time.hidden-xs
                        .question-bank-passed
                          %i.glyphicon.glyphicon-ok-circle{style: 'font-size: large'}
                          Passed
                  -else
                    =link_to new_student_url, class: 'list-group-item link-purple box-topic-item' do
                      .box-topic-item
                        =@course.question_bank.name
                      .time.hidden-xs
                        .question-bank-passed
                          %i.glyphicon.glyphicon-ok-circle{style: 'font-size: large'}
                          Passed
                  -if @subject_course_user_log.completed
                    %hr/
                    -if current_user
                      =link_to completion_certs_url(@cert.id, format: 'pdf'), class: 'cert-box-item lib-panel', style: 'text-decoration: none;' do
                        .box-topic-item
                          Click here to download your completion certificate
                    -else
                      =link_to completion_certs_url(@cert.id, format: 'pdf'), class: 'cert-box-item lib-panel', style: 'text-decoration: none;' do
                        .box-topic-item
                          Click here to download your completion certificate
                -else
                  -if current_user
                    =link_to course_question_bank_url(@course.name_url, @course.question_bank.id), class: 'cert-box-item lib-panel', style: 'text-decoration: none;' do
                      .box-topic-item
                        =@course.question_bank.name
                      .time.hidden-xs
                        =@course.question_bank.number_of_questions.to_s + ' Questions'
                  -else
                    =link_to new_student_url, class: 'list-group-item link-purple box-topic-item' do
                      .box-topic-item
                        =@course.question_bank.name
                      .time.hidden-xs
                        =@course.question_bank.number_of_questions.to_s + ' Questions'
              -else
                -if @subject_course_user_log && @subject_course_user_log.completed
                  %hr/
                  -if current_user
                    =link_to completion_certs_url(@cert.id, format: 'pdf'), class: 'cert-box-item lib-panel', style: 'text-decoration: none;' do
                      .box-topic-item
                        Click here to download your completion certificate
                  -else
                    =link_to new_student_url, class: 'list-group-item link-purple box-topic-item' do
                      .box-topic-item
                        Click here to download your completion certificate




  =render partial: 'layouts/new_footer'
  =render partial: 'shared/activate_tab'