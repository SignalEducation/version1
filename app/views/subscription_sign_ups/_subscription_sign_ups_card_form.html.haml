.col-sm-12
  .col-sm-6
    %section#africaplans
      .container
        .plans
          .plan{class: plan_interval(@africa_subscription_plan.payment_frequency_in_months), id: "sub-#{@africa_subscription_plan.currency.iso_code}-#{@africa_subscription_plan.payment_frequency_in_months}", data: {plan_id: @africa_subscription_plan.id, price: @africa_subscription_plan.currency.format_number(@africa_subscription_plan.price), interval: @africa_subscription_plan.payment_frequency_in_months}}
            .base.transparent
              .box
                .name
                  =t("views.general.payment_frequency_in_months.a#{@africa_subscription_plan.payment_frequency_in_months}")
                %ul.details.fa-ul
                  %li
                    %i.fa-li.fa.fa-check
                    =t('views.subscriptions.new_subscription.get_unlimited_access')
                  %li
                    %i.fa-li.fa.fa-check
                    =t('views.subscriptions.new_subscription.cancel_anytime')
                  %li
                    %i.fa-li.fa.fa-check
                    =t("views.general.subscription_ideal_line.a#{@africa_subscription_plan.payment_frequency_in_months}")

                .price
                  =@africa_subscription_plan.currency.format_number(@africa_subscription_plan.price)



  .col-sm-6
    %section#simply.africa

      .payment-errors
        .form-group.cc
          %label
            %h4{style: 'padding-bottom: 0;'}
              =t('views.subscriptions.new_subscription.credit_card')
          .clearfix
            #card-element

            #card-errors{role: 'alert'}


        .form-group.l-margin-bottom-big
          .col-xs-6{style: 'padding-left: 5px;'}
            %label
              %h4{style: 'padding-bottom: 0;'}
                =t('views.subscriptions.new_subscription.coupon_code')
          .col-xs-6.invalid-code{style: 'color: #EF5153;'}
            ='Invalid Code'
          %input{type: 'text_field', id: 'coupon_code', class: 'form-control', placeholder: 'Valid Coupon Code'}

        .form-group.l-margin-top
          %label.check
            %input{type: 'checkbox', id: 'terms_and_conditions', required: true}
              %span
                %i.fa.fa-check
              =t('views.general.terms_and_conditions')



        .form-group.l-margin-top
          .tot-get
            .price
              %span.total Total:
              %span.value#total-value
                =@africa_subscription_plan.currency.format_number(@africa_subscription_plan.price)
            .price.discounted-price
              %span.total Discounted Total:
              %span.value#discounted-value
                =@africa_subscription_plan.currency.format_number(@africa_subscription_plan.price)

.col-sm-12.l-margin-bottom-huge
  .col-sm-8.col-sm-offset-2
    %div
      =f.button :submit, class: 'lsbtn full-width', id: 'card_submit' do
        %i.fa.fa-lock
        =t('views.users.upgrade_subscription.upgrade_subscription')

      .sk-circle.text-center
        .sk-circle1.sk-child
        .sk-circle2.sk-child
        .sk-circle3.sk-child
        .sk-circle4.sk-child
        .sk-circle5.sk-child
        .sk-circle6.sk-child
        .sk-circle7.sk-child
        .sk-circle8.sk-child
        .sk-circle9.sk-child
        .sk-circle10.sk-child
        .sk-circle11.sk-child
        .sk-circle12.sk-child


    .form-group.l-margin-top-big
      .obs
        %p
          <strong>NOTE</strong> - You are subscribing to a <strong>recurring payment</strong> which will continue until you cancel your subscription.
        %p
          =t('views.subscriptions.new_subscription.remember_cancel_anytime')




:javascript

  $('input[type="checkbox"]').on('change', function() {
    if($('#terms_and_conditions').prop('checked') == true) {
      $("#hidden_term_and_conditions").val('true');
    } else if($('#terms_and_conditions').prop('checked') == false) {
      $("#hidden_term_and_conditions").val('false');
    }
  });

  // Custom styling can be passed to options when creating an Element.
  var style = {
    base: {
      fontWeight: 300,
      fontFamily: 'Rubik',
      fontSize: '20px',
      lineHeight: '24px'
    }
  };

  var stripe = Stripe('#{ENV['LEARNSIGNAL_V3_STRIPE_PUBLIC_KEY']}');
  var elements = stripe.elements();

  var card = elements.create('card', {hidePostalCode: true, style: style});
  card.mount('#card-element');


  function stripeTokenHandler(token) {
    // Insert the token ID into the form so it gets submitted to the server
    var form = document.getElementById('upgrade-form');
    $('#user_subscriptions_attributes_0_stripe_token').val(token.id);
    $('#hidden_coupon_code').val($('#coupon_code').val());

    // Submit the form
    form.submit();
  }

  function createToken() {
    stripe.createToken(card).then(function(result) {
      if (result.error) {
        // Inform the user if there was an error
        var errorElement = document.getElementById('card-errors');
        errorElement.textContent = result.error.message;
        //Replace spinning JS with Submit button
        $('#card_submit').prop('disabled',false);
        $('#card_submit').show();
        $(".sk-circle").hide();

      } else {
        // Send the token to your server
        stripeTokenHandler(result.token);
      }
    });
  };

  // Create a token when the form is submitted.
  var form = document.getElementById('upgrade-form');
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    //Replace submit button with spinning JS
    $('#card_submit').prop('disabled',true);
    $('#card_submit').hide();
    $(".sk-circle").show();
    createToken();
  });



  card.addEventListener('change', function(event) {
    var displayError = document.getElementById('card-errors');
    if (event.error) {
      displayError.textContent = event.error.message;
    } else {
      displayError.textContent = '';
    }
  });



