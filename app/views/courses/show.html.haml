%main.sidebar-right-main
  =render partial: 'mobile_nav'
  %article#sidebar-right-content.courses.bg-gray5
    .courses-container
      %div.course-show-external-banner#courses-show-external-banner
        =render partial: 'layouts/external_banner'
      %header
        .d-flex.flex-wrap.flex-sm-nowrap.justify-content-between.py-4.py-md-5
          -if @course_step
            =render partial: 'prev_lesson_navigation'

          -if @course_step
            .pt-3.sidebar-right-title
              %h1.h3
                =@course_step.name

          .right-topbar-item.color-shade.course-nav-helpers{onclick: "openZendesk()"}
            %i.material-icons.icon-bg-round{"aria-label" => "failed", :role => "img", :title => "Contact Us"}help_outline

          -if @course_step
            =render partial: 'next_lesson_navigation'

      %section.course-content
        -if defined?(@results)
          =render partial: 'courses/show_results', locals: {cme: @course_step}
        -else
          -if @course_step.try(:is_video)
            =render partial: 'courses/show_video', locals: {cme: @course_step}
          -elsif @course_step.try(:is_quiz)
            =render partial: 'courses/show_quiz'
          -elsif @course_step.try(:is_note)
            =render partial: 'courses/show_notes', locals: { notes: @course_step.course_note, log: @course_step_log }
          -elsif @course_step.try(:is_practice_question)
            =render partial: 'courses/show_practice_question', locals: { practice_question: @course_step.course_practice_question, step_log_id:  @course_step_log.id }
          -elsif @course_step.try(:is_constructed_response)
            #constructed-response-start-screen{data: {step_id: @course_step.id, step_name: @course_step.name, module_id: @course_lesson.id, module_name: @course_lesson.name, course_id: @course.id,
             course_name: @course.name, exam_body_id: @group.exam_body.id, exam_body_name: @group.exam_body.name, onboarding: current_user&.onboarding_process&.active&.to_s, free_lesson: @course_lesson.free.to_s,
              order: @index_order, previous_completion_count: 'tbc', cr_question_count: @course_step&.constructed_response&.scenario&.scenario_questions&.count }}
              =render partial: 'courses/constructed_response_start'
          -else
            %h2 Course module element - type unknown
            -Rails.logger.error "views/courses/show - unknown CME type. CME: #{@course_step.inspect}."

  #upgrade-subscription-modal.video-upgrade-modal-hide
    .upgrade-btn-slide
      .modal-wrapper
        .modal
          .head
            %a.btn-close.trigger{onclick: "upgradeClose()"}
              %i.fa.fa-times{"aria-hidden" => "true"}
          .content
            .good-job
              %i.fa.fa-thumbs-o-up{"aria-hidden" => "true"}
              %h1 Good Job!
              =link_to "Upgrade Now ", pricing_url(current_user&.preferred_exam_body&.group&.name_url), class: "btn btn-primary upgrade-arrow", data: {step_id: @course_step.id, step_name: @course_step.name, module_id: @course_lesson.id, module_name: @course_lesson.name, course_id: @course.id, course_name: @course.name, exam_body_id: @group.exam_body.id, exam_body_name: @group.exam_body.name, time_triggered: @course_step.vid_end_seconds}

- if current_user
  =render partial: 'library/subscription_restriction_modal'
  =render partial: 'library/related_lesson_restriction_modal'
  =render partial: 'library/user_form_modal', locals: { ticket_type: 'Contact Us', form_id: 'contact-form-modal' }

  :javascript

    function upgradeClose() {
      console.log('Upgrade Close');
      $("#upgrade-subscription-modal").css("display", "none");
    }

    function openZendesk() {
      $zopim.livechat.window.show()
    }
