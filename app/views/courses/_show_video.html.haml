-if !@demo_mode = true
  .box-item.question-box.border-same-backcolor.width-bigger#quiz-contents{style: 'min-height: 645px;'}
    %h2
      =cme.name
    -if cme.course_module_element_video.try(:video_id)
      %div{id: "wistia_#{cme.course_module_element_video.try(:video_id)}",class: 'wistia_embed', style: 'height:360px;width:640px'}
    -else
      #video-window
    .l-margin-bottom.l-margin-top
      .col-xs-4.text-left
        =link_to course_special_link(cme.previous_element), class: 'btn btn-red text-bold' do
          .glyphicon.glyphicon-arrow-left
          =t('views.course_module_elements.show.previous_step')
      .col-xs-4.text-center
        -if current_user.try(:admin?)
          =link_to t('views.general.edit'), course_module_special_link(cme), target: '_blank', class: 'btn btn-red text-bold'
      .col-xs-4.text-right
        -if cme.course_module.subject_course.is_cpd
          =link_to course_special_link(cme.next_element), class: 'btn btn-red text-bold' do
            =t('views.course_module_elements.show.next_step')
            .glyphicon.glyphicon-arrow-right
        -else
          =link_to course_special_link(cme.next_element), class: 'btn btn-red text-bold mark-as-complete' do
            =t('views.course_module_elements.show.mark_complete')
            .glyphicon.glyphicon-arrow-right

      .pull-left
        -unless cme.description.blank?
          %br/
          %h3=t('views.course_module_elements.form.description')
          .pull-left
            =cme.description.html_safe
        -#if @course_module.try(:parent).try(:forum_url)
          %br/
          %h6
            .pull-left
              =link_to "Discuss #{cme.name} in the Forum", @course_module.parent.try(:forum_url), target: '_blank'

  -#.box-item.question-box.border-same-backcolor.width-bigger
    .cme-nav
      =render partial: 'courses/cme_nav', locals: {cme: @course_module_element}

  -if cme.course_module_element_resources.all_in_order.count > 0
    .row
      .col-sm-12
        %h2=t('views.course_module_element_resources.index.h1')
        %ul
          -cme.course_module_element_resources.all_in_order.each do |r|
            -if r.web_url && r.web_url.length > 0
              %li
                =link_to r.name, r.web_url, target: '_blank'
            -else
              %li
                =link_to r.name, r.upload.url, target: '_blank'

  :javascript
    var videoCmeUserLog = #{@video_cme_user_log.id || 0};

    $(document).on('click', '.mark-as-complete', function(ajax) {
      $.ajax({
        url: '#{video_watched_data_courses_path}',
        dataType: 'json',
        data: JSON.stringify({'videoLogId': videoCmeUserLog}),
        method: 'PATCH',
        contentType: "application/json; charset=utf-8"
      });
    });

    wistiaEmbed = Wistia.embed("#{cme.course_module_element_video.try(:video_id)}", {
      videoFoam: true,
      stillUrl: 'https://dvetmi3t70548.cloudfront.net/video-still-image-2.png'
    });

    wistiaEmbed.bind("secondchange", function() {
      var time1 = (wistiaEmbed.duration()/100*75);
      var time2 = time1 + 2;
      if (wistiaEmbed.secondsWatched() > time1 && wistiaEmbed.secondsWatched() < time2) {
        $.ajax({
          url: '#{video_watched_data_courses_path}',
          dataType: 'json',
          data: JSON.stringify({'videoLogId': videoCmeUserLog}),
          method: 'PATCH',
          contentType: "application/json; charset=utf-8"
        });
      }
    })


-else

  .box-item.question-box.border-same-backcolor.width-bigger#quiz-contents{style: 'min-height: 645px;'}
    %h2
      =cme.name
    -if cme.course_module_element_video.try(:video_id)
      %div{id: "wistia_#{cme.course_module_element_video.try(:video_id)}",class: 'wistia_embed', style: 'height:360px;width:640px'}
    -else
      #video-window
    .l-margin-bottom.l-margin-top
      .col-xs-4.text-left
      .col-xs-4.text-center
        -if current_user.try(:admin?)
          =link_to t('views.general.edit'), course_module_special_link(cme), target: '_blank', class: 'btn btn-red text-bold'
      .col-xs-4.text-right
      .pull-left
        -unless cme.description.blank?
          %br/
          %h3=t('views.course_module_elements.form.description')
          .pull-left
            =cme.description.html_safe
  -#if @course_module.try(:parent).try(:forum_url)
          %br/
          %h6
            .pull-left
              =link_to "Discuss #{cme.name} in the Forum", @course_module.parent.try(:forum_url), target: '_blank'

  -#.box-item.question-box.border-same-backcolor.width-bigger
    .cme-nav
      =render partial: 'courses/cme_nav', locals: {cme: @course_module_element}

  -if cme.course_module_element_resources.all_in_order.count > 0
    .row
      .col-sm-12
        %h2=t('views.course_module_element_resources.index.h1')
        %ul
          -cme.course_module_element_resources.all_in_order.each do |r|
            -if r.web_url && r.web_url.length > 0
              %li
                =link_to r.name, r.web_url, target: '_blank'
            -else
              %li
                =link_to r.name, r.upload.url, target: '_blank'

  :javascript

    $(document).on('click', '.mark-as-complete', function(ajax) {
      $.ajax({
        url: '#{video_watched_data_courses_path}',
        dataType: 'json',
        data: JSON.stringify({'videoLogId': videoCmeUserLog}),
        method: 'PATCH',
        contentType: "application/json; charset=utf-8"
      });
    });

    wistiaEmbed = Wistia.embed("#{cme.course_module_element_video.try(:video_id)}", {
      videoFoam: true,
      stillUrl: 'https://dvetmi3t70548.cloudfront.net/video-still-image-2.png'
    });

    wistiaEmbed.bind("secondchange", function() {
      var time1 = (wistiaEmbed.duration()/100*75);
      var time2 = time1 + 2;
      if (wistiaEmbed.secondsWatched() > time1 && wistiaEmbed.secondsWatched() < time2) {
        $.ajax({
          url: '#{video_watched_data_courses_path}',
          dataType: 'json',
          data: JSON.stringify({'videoLogId': videoCmeUserLog}),
          method: 'PATCH',
          contentType: "application/json; charset=utf-8"
        });
      }
    })
