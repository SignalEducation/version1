%main.pricingPageWrapper.pricingPlansWrapper
  %article
    .container-bg
      .container
        %article.py-5
          %header.text-center.pb-3.pb-md-4
            %div.heroSubtext
              ="#{@group&.name} PRICING"
            %div.heroTitle
              Our subscriptions fit your needs üí∂
            -# %div.heroTitle
            -#   -if @group&.exam_body&.pricing_heading
            -#     =@group.exam_body.pricing_heading
            -#   -else
            -#     ="#{@group&.name} Payment Plans"

            %p.heroDesc
              Customised pricing plans designed to fit in with your wallet and work.
            -# %p.heroDesc
            -#   -if @group&.exam_body&.pricing_subheading
            -#     =@group.exam_body.pricing_subheading
            -#   -else
            -#     ="Instant Access to all #{@group&.name} Courses"

          -if @group
            .row.row-lg.justify-content-center
              -# PREMIUM CARDS
              .col-lg-8.px-2
                %article.planCard
                  .card-body.text-left.p-0
                    .tab-content
                      -@subscription_plans.each_with_index do |plan, counter|
                        .tab-pane{id: "nav-#{plan.guid}", class: "tab-#{plan.guid} #{counter == 0 ? 'active' : ''} ", "aria-labelledby" => "#{plan.guid}-tab", :role => "tabpanel"}
                          %div.planInfoWrapper
                            %div.planTitleWrapper
                              %div.planTitle
                                Premium 
                                %span.greenShade=t("views.general.payment_intervals.a#{plan.payment_frequency_in_months}")
                                Plan
                              %ul.nav.nav-pills.plan-nav{id: 'planTabs', role: 'tablist', class:@subscription_plans.length < 2 && 'hidden'}
                                -@subscription_plans.each_with_index do |navPlan, navCounter|
                                  %li.nav-item{data: {tab_name: navPlan.guid}}
                                    %a{class: "nav-link #{navCounter == counter ? 'active' : ''}", id: "#{navPlan.guid}-tab", data: {toggle: 'tab'}, href: "#nav-#{navPlan.guid}", aria: {controls: "#{navPlan.guid}", selected: 'false'}, role: 'tab'}
                                      =t("views.general.payment_intervals.a#{navPlan.payment_frequency_in_months}")
                            %p.priceValue.mb-0.pb-4
                              %span.priceValue-actualPrice
                                =plan.currency.format_number(plan.price)
                                %span.priceValue-priceSuffix=t("views.general.payment_interval_shortSuffix.a#{plan.payment_frequency_in_months}")
                              %span.d-flex.flex-column.align-items-center
                                %span.priceValue-popularBadge
                                  Most popular
                                -if plan.monthly_percentage_off
                                  %span.priceValue-savingPill.mt-1
                                    Save 
                                    =plan.monthly_percentage_off
                                    ='%'
                          
                          .bulletListTitle.hidden-xs ‚ö°Ô∏è What do you get
                          %ul.hidden-xs.list-centered.text-left.bulletList{class:@subscription_plans.length < 2 && 'noPlanNav'}
                            %li.mb-3
                              .bulletIcon ‚Ä¢
                              %span
                                Everything in üéâ FREE
                            -if plan.bullet_points_list && !plan.bullet_points_list.empty?
                              - plan.bullet_points_list.split(/, ?/).each do |bullet|
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span=bullet
                            -else
                              %li.mb-3
                                .bulletIcon ‚Ä¢
                                %span="Access all #{@group && @group.name} courses"
                              %li.mb-3
                                .bulletIcon ‚Ä¢
                                %span="Topic-by-topic lectures"
                              %li.mb-3
                                .bulletIcon ‚Ä¢
                                %span="24/7 tutor support"

                          
                          -unless plan.exam_body.name == "CPD"
                            %p.preCtaText
                              Recurring Payment. Cancel Anytime
                          .mt-auto
                            =link_to subscription_checkout_special_link(plan.exam_body_id, plan.guid), class: "btn w-100 btn-primary choosePlanBtn", onclick: "addToCart('#{plan.currency.iso_code}', '#{plan.name}', '#{plan.id}', '#{plan.price}', '#{plan.exam_body.name}');" do
                              ="Choose #{t("views.general.payment_intervals.a#{plan.payment_frequency_in_months}")}"
                          %div.visible-xs.bulletListAccordianBox
                            .faq-box.mt-3
                              .faq-inner.narrow{onclick: '$(this).toggleClass("narrow"); $(this).find(".faq-answer").toggleClass("d-md-block"); $(this).find(".faq-answer-expanded").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-openIcon").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-closeIcon").toggleClass("d-none");'}
                                .faq-title
                                  See Details
                                  %i.material-icons.ml-2.bulletListAccordianBox-openIcon{"aria-hidden" => "true"} expand_more
                                  %i.material-icons.ml-2.bulletListAccordianBox-closeIcon.d-none{"aria-hidden" => "true"} expand_less
                                .faq-answer-expanded.d-none
                                  .bulletListTitle ‚ö°Ô∏è What do you get
                                  %ul.list-centered.text-left.bulletList{class:@subscription_plans.length < 2 && 'noPlanNav'}
                                    %li.mb-3
                                      .bulletIcon ‚Ä¢
                                      %span
                                        Everything in üéâ FREE
                                    -if plan.bullet_points_list && !plan.bullet_points_list.empty?
                                      - plan.bullet_points_list.split(/, ?/).each do |bullet|
                                        %li.mb-3
                                          .bulletIcon ‚Ä¢
                                          %span=bullet
                                    -else
                                      %li.mb-3
                                        .bulletIcon ‚Ä¢
                                        %span="Access all #{@group.name} courses"
                                      %li.mb-3
                                        .bulletIcon ‚Ä¢
                                        %span="Topic-by-topic lectures"
                                      %li.mb-3
                                        .bulletIcon ‚Ä¢
                                        %span="24/7 tutor support"
                    -# %ul.nav.nav-pills.plan-nav{id: 'planTabs', role: 'tablist', class:@subscription_plans.length < 2 && 'hidden'}
                    -#   -@subscription_plans.each_with_index do |plan, counter|
                    -#     %li.nav-item{data: {tab_name: plan.guid}}
                    -#       %a{class: "nav-link #{counter == 0 ? 'active' : ''}", id: "#{plan.guid}-tab", data: {toggle: 'tab'}, href: "#nav-#{plan.guid}", aria: {controls: "#{plan.guid}", selected: 'false'}, role: 'tab'}
                    -#         =t("views.general.payment_intervals.a#{plan.payment_frequency_in_months}")
              
              -# LIFETIME CARD
              -@products.each do |product|
                -link = product_link(product, current_user, params[:login])
                -name = product.name_by_type
                .col-lg-8.px-2
                  %article.planCard.planCard-light
                    .card-body.text-left.p-0
                      %div.planInfoWrapper
                        %div.planTitleWrapper
                          %div.planTitle
                            -name
                            %span.greenShade Lifetime
                            Membership

                        %p.priceValue.mb-0.pb-4
                          %span.priceValue-actualPrice
                            =number_in_local_currency(product.price, product.currency)
                      
                      .bulletListTitle.hidden-xs ‚ö°Ô∏è What do you get
                      %ul.hidden-xs.list-centered.text-left.bulletList
                        %li.mb-3
                          .bulletIcon ‚Ä¢
                          %span Everything in Premium plan
                        %li.mb-3
                          .bulletIcon ‚Ä¢
                          %span="Access all #{@group.name} courses Forever"
                        %li.mb-3
                          .bulletIcon ‚Ä¢
                          %span Most economical plan
                        %li.mb-3
                          .bulletIcon ‚Ä¢
                          %span No hassle of renewals
                      %p.preCtaText
                        One-time payment
                      .mt-auto
                        = link_to 'Choose Lifetime', link, class: 'btn btn-primary choosePlanBtn w-100 ', onclick: "gtag('event', 'clicks_plan', {'event_category': 'pre-registration', 'event_label': '#{name}'});"
                      %div.visible-xs.bulletListAccordianBox
                        .faq-box.mt-3
                          .faq-inner.narrow{onclick: '$(this).toggleClass("narrow"); $(this).find(".faq-answer").toggleClass("d-md-block"); $(this).find(".faq-answer-expanded").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-openIcon").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-closeIcon").toggleClass("d-none");'}
                            .faq-title
                              See Details
                              %i.material-icons.ml-2.bulletListAccordianBox-openIcon{"aria-hidden" => "true"} expand_more
                              %i.material-icons.ml-2.bulletListAccordianBox-closeIcon.d-none{"aria-hidden" => "true"} expand_less
                            .faq-answer-expanded.d-none
                              .bulletListTitle ‚ö°Ô∏è What do you get
                              %ul.list-centered.text-left.bulletList
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span Everything in Premium plan
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span="Access all #{@group.name} courses Forever"
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span Most economical plan
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span No hassle of renewals

          -else
            %nav.levels-nav
              %ul.nav.nav-pills.nav-fill{id: 'levelsTabs', role: 'tablist'}
                - @exam_bodies.each_with_index do |exam_body, counter|
                  %li.nav-item{data: {tab_name: exam_body.name}}
                    %a{class: "nav-link #{counter == 0 ? 'active' : ''}", id: "#{exam_body.group.name_url}-tab", data: {toggle: 'tab'}, href: "#examBodytab-#{exam_body.group.name_url}", aria: {controls: "#{exam_body.group.name_url}", selected: 'false'}, role: 'tab', onclick: "gtag('event', 'clicks_exam_body_price', {'event_category': 'pre-registration', 'event_label': '#{exam_body.name}'});"}
                      =exam_body.name

            %section.py-3.py-md-4
              %h2.sr-only List of Plans
              #levelsTabsContent.tab-content
                -@exam_bodies.each_with_index do |exam_body, counter|
                  .tab-pane{id: "examBodytab-#{exam_body.group.name_url}", class: "tab-#{exam_body.group.name_url} #{counter == 0 ? 'active show' : ''} ", "aria-labelledby" => "#{exam_body.group.name_url}-tab", :role => "tabpanel"}
                    -# Each ExamBody PricingTab
                    .row.row-lg.justify-content-center.mt-5
                      
                      -# PREMIUM CARDS
                      .col-lg-6.px-2
                        %article.planCard.planCard-popular
                          .card-body.text-left.p-0
                            .tab-content
                              -@subscription_plans.where(exam_body_id: exam_body.id).each_with_index do |plan, counter|
                                .tab-pane{id: "nav-#{plan.guid}", class: "tab-#{plan.guid} #{counter == 0 ? 'active' : ''} ", "aria-labelledby" => "#{plan.guid}-tab", :role => "tabpanel"}
                                  %div.planTitleWrapper
                                    %div.planTitle
                                      Premium 
                                      %span.greenShade=t("views.general.payment_intervals.a#{plan.payment_frequency_in_months}")
                                      Plan
                                    %p.priceValue.mb-0.pb-4
                                      %span.priceValue-actualPrice
                                        =plan.currency.format_number(plan.price)
                                        %span.priceValue-priceSuffix=t("views.general.payment_interval_shortSuffix.a#{plan.payment_frequency_in_months}")
                                      %span.priceValue-popularBadge
                                        Most popular
                                      -if plan.monthly_percentage_off
                                        %span.priceValue-savingPill
                                          Save 
                                          =plan.monthly_percentage_off
                                          ='%'
                                  
                                  .bulletListTitle.hidden-xs ‚ö°Ô∏è What do you get
                                  %ul.hidden-xs.list-centered.text-left.bulletList{class:@subscription_plans.length < 2 && 'noPlanNav'}
                                    %li.mb-3
                                      .bulletIcon ‚Ä¢
                                      %span
                                        Everything in üéâ FREE
                                    -if plan.bullet_points_list && !plan.bullet_points_list.empty?
                                      - plan.bullet_points_list.split(/, ?/).each do |bullet|
                                        %li.mb-3
                                          .bulletIcon ‚Ä¢
                                          %span=bullet
                                    -else
                                      %li.mb-3
                                        .bulletIcon ‚Ä¢
                                        %span="Access all #{exam_body.group.name} courses"
                                      %li.mb-3
                                        .bulletIcon ‚Ä¢
                                        %span="Topic-by-topic lectures"
                                      %li.mb-3
                                        .bulletIcon ‚Ä¢
                                        %span="24/7 tutor support"

                                  
                                  -unless plan.exam_body.name == "CPD"
                                    %p.text-gray2.mt-4.mb-2.text-bold
                                      Recurring Payment. Cancel Anytime
                                  .mt-auto
                                    =link_to subscription_checkout_special_link(plan.exam_body_id, plan.guid), class: "btn w-100 btn-primary choosePlanBtn", onclick: "addToCart('#{plan.currency.iso_code}', '#{plan.name}', '#{plan.id}', '#{plan.price}', '#{plan.exam_body.name}');" do
                                      ="Choose #{t("views.general.payment_intervals.a#{plan.payment_frequency_in_months}")}"
                                  %div.visible-xs.bulletListAccordianBox
                                    .faq-box.mt-3
                                      .faq-inner.narrow{onclick: '$(this).toggleClass("narrow"); $(this).find(".faq-answer").toggleClass("d-md-block"); $(this).find(".faq-answer-expanded").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-openIcon").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-closeIcon").toggleClass("d-none");'}
                                        .faq-title
                                          See Details
                                          %i.material-icons.ml-2.bulletListAccordianBox-openIcon{"aria-hidden" => "true"} expand_more
                                          %i.material-icons.ml-2.bulletListAccordianBox-closeIcon.d-none{"aria-hidden" => "true"} expand_less
                                        .faq-answer-expanded.d-none
                                          .bulletListTitle ‚ö°Ô∏è What do you get
                                          %ul.list-centered.text-left.bulletList{class:@subscription_plans.length < 2 && 'noPlanNav'}
                                            %li.mb-3
                                              .bulletIcon ‚Ä¢
                                              %span
                                                Everything in üéâ FREE
                                            -if plan.bullet_points_list && !plan.bullet_points_list.empty?
                                              - plan.bullet_points_list.split(/, ?/).each do |bullet|
                                                %li.mb-3
                                                  .bulletIcon ‚Ä¢
                                                  %span=bullet
                                            -else
                                              %li.mb-3
                                                .bulletIcon ‚Ä¢
                                                %span="Access all #{exam_body.group.name} courses"
                                              %li.mb-3
                                                .bulletIcon ‚Ä¢
                                                %span="Topic-by-topic lectures"
                                              %li.mb-3
                                                .bulletIcon ‚Ä¢
                                                %span="24/7 tutor support"
                                
                                
                                -# .tab-pane{id: "nav-#{plan.guid}", class: "tab-#{plan.guid} #{counter == 0 ? 'active' : ''} ", "aria-labelledby" => "#{plan.guid}-tab", :role => "tabpanel"}
                                -#   %p.priceValue.mb-0.pb-4
                                -#     =plan.currency.format_number(plan.price)
                                -#   %ul.list-centered.text-left.border-top.pt-4.bulletList{class:@subscription_plans.where(exam_body_id: exam_body.id).length < 2 && 'noPlanNav'}
                                -#     -if plan.bullet_points_list && !plan.bullet_points_list.empty?
                                -#       - plan.bullet_points_list.split(/, ?/).each do |bullet|
                                -#         %li.mb-3
                                -#           %span=bullet
                                -#     -else
                                -#       %li.mb-3="Access all #{@plan.exam_body.name} courses"
                                -#       %li.mb-3="Topic-by-topic lectures"
                                -#       %li.mb-3="24/7 tutor support"

                                -#   -if plan.monthly_percentage_off
                                -#     %p.h5.text-gray2
                                -#       Save over
                                -#       =plan.monthly_percentage_off
                                -#       ='%'
                                -#   .mt-auto
                                -#     =link_to subscription_checkout_special_link(plan.exam_body_id, plan.guid), class: "btn w-100 btn-primary", onclick: "addToCart('#{plan.currency.iso_code}', '#{plan.name}', '#{plan.id}', '#{plan.price}', '#{plan.exam_body.name}');" do
                                -#       Choose this plan
                                -#   -unless plan.exam_body.name == "CPD"
                                -#     %p.text-gray2.mt-4
                                -#       Cancel anytime
                            %ul.nav.nav-pills.plan-nav{id: 'planTabs', role: 'tablist', class:@subscription_plans.where(exam_body_id: exam_body.id).length < 2 && 'hidden'}
                              -@subscription_plans.where(exam_body_id: exam_body.id).each_with_index do |plan, counter|
                                %li.nav-item{data: {tab_name: plan.guid}}
                                  -# TODO add active to first li
                                  %a{class: "nav-link #{counter == 0 ? 'active' : ''}", id: "#{plan.guid}-tab", data: {toggle: 'tab'}, href: "#nav-#{plan.guid}", aria: {controls: "#{plan.guid}", selected: 'false'}, role: 'tab'}
                                    =t("views.general.payment_intervals.a#{plan.payment_frequency_in_months}")
                      
                      -# LIFETIME CARD
                      -@products.where(group_id: exam_body.group.id).each do |product|
                        -link = product_link(product, current_user, params[:login])
                        -name = product.name_by_type
                        .col-lg-6.px-2
                          %article.planCard
                            .card-body.text-left.p-0
                              %div.planTitleWrapper
                                %div.planTitle
                                  -name
                                  %span.greenShade Lifetime
                                  Membership
                                %p.priceValue.mb-0.pb-4
                                  %span.priceValue-actualPrice
                                    =number_in_local_currency(product.price, product.currency)
                              
                              .bulletListTitle.hidden-xs ‚ö°Ô∏è What do you get
                              %ul.hidden-xs.list-centered.text-left.bulletList
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span Everything in Premium plan
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span="Access all #{exam_body.group.name} courses Forever"
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span Most economical plan
                                %li.mb-3
                                  .bulletIcon ‚Ä¢
                                  %span No hassle of renewals
                              %p.text-gray2.mt-4.mb-2.text-bold
                                One-time payment
                              .mt-auto
                                = link_to 'Choose Lifetime', link, class: 'btn btn-primary choosePlanBtn w-100 ', onclick: "gtag('event', 'clicks_plan', {'event_category': 'pre-registration', 'event_label': '#{name}'});"
                              %div.visible-xs.bulletListAccordianBox
                                .faq-box.mt-3
                                  .faq-inner.narrow{onclick: '$(this).toggleClass("narrow"); $(this).find(".faq-answer").toggleClass("d-md-block"); $(this).find(".faq-answer-expanded").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-openIcon").toggleClass("d-none"); $(this).find(".bulletListAccordianBox-closeIcon").toggleClass("d-none");'}
                                    .faq-title
                                      See Details
                                      %i.material-icons.ml-2.bulletListAccordianBox-openIcon{"aria-hidden" => "true"} expand_more
                                      %i.material-icons.ml-2.bulletListAccordianBox-closeIcon.d-none{"aria-hidden" => "true"} expand_less
                                    .faq-answer-expanded.d-none
                                      .bulletListTitle ‚ö°Ô∏è What do you get
                                      %ul.list-centered.text-left.bulletList
                                        %li.mb-3
                                          .bulletIcon ‚Ä¢
                                          %span Everything in Premium plan
                                        %li.mb-3
                                          .bulletIcon ‚Ä¢
                                          %span="Access all #{exam_body.group.name} courses Forever"
                                        %li.mb-3
                                          .bulletIcon ‚Ä¢
                                          %span Most economical plan
                                        %li.mb-3
                                          .bulletIcon ‚Ä¢
                                          %span No hassle of renewals

:javascript
  function addToCart(currency, plan_name, plan_id, price, brand, interval_name) {
    gtag('event', 'clicks_plan', {'event_category': 'pre-registration', 'event_label': interval_name});

    fbq('track', 'AddToCart', {
      value: price,
      currency: currency,
      name: plan_name,
      brand: brand,
      subscription_interval: interval_name,
      content_category: 'Subscription'
    });

    window.uetq = window.uetq || [];
    window.uetq.push('event', 'AddToCart', {
      'event_category': 'Subscription',
      'event_label': plan_name,
      'event_value': price
    });
  }

  $( document ).ready(function() {
    let banner = "#{@banner.present?.to_s}";
    let preferredExamBodyId = "#{current_user&.preferred_exam_body_id}";
    let preferredExamBody = "#{current_user&.preferred_exam_body&.name}";
    let onboarding = "#{current_user&.analytics_onboarding_valid?.to_s}";
    let planNames = [];
    let productNames = [];
    let planElements = $(".card.plan");
    planElements.each(function(){ planNames.push(this.id); });
    let productElements = $(".card.product");
    productElements.each(function(){ productNames.push(this.id); });

    analytics.page("#{@group&.name} " + 'Pricing', {
      preferredExamBodyId: preferredExamBodyId,
      preferredExamBody:preferredExamBody ,
      banner: banner,
      onboarding: onboarding,
      examBodyId: "#{@exam_body&.id}",
      examBodyName: "#{@exam_body&.name}",
      currency: "#{@currency&.iso_code}",
      subscriptionPlanOptions: "#{@subscription_plans.map(&:id)}",
      subPlanNames: planNames,
      productOptions: "#{@products.map(&:id)}",
      productNames: productNames
    });
  });
