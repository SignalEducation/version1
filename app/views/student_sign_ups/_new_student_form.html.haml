#sign-up-ls
  %h1.mb-2.ls-row-title
    Sign up
  %p.p-hero.ls-row-subtitle 
    ="Sign Up to get everything you need to pass your Accounting & Finance exams in one place!"
  =form_for @user, url: create_student_url do |f|
    =render partial: 'layouts/error_messages', locals: {thing: @user, message: t('views.home_pages.sign_up_form.error_panel_caption')}
    =f.hidden_field :locale, value: ('en')
    =f.hidden_field :terms_and_conditions, id: 'hidden_term_and_conditions'
    =f.hidden_field :communication_approval, id: 'hidden_communication_approval'
    =f.hidden_field :first_name, id: 'first_name'
    =f.hidden_field :last_name, id: 'last_name'
    %fieldset.pb-3
      %legend.sr-only Registration Details
      .row
        .col-sm-12
          .form-group
            =f.label 'Name', class: 'ls-row-option'
            %input{autofocus: true, placeholder: 'Enter your full name', class: 'form-control ls-row-option-placeholder', id: 'user_first_and_last_name', required: true}

        .col-sm-12
          .form-group
            =f.label :email, t('views.users.form.email'), class: 'ls-row-option'
            =f.email_field :email, class: 'form-control ls-row-option-placeholder', placeholder: 'Enter your email', id: 'user_email', required: true

        .col-sm-12
          .form-group
            =f.label :password, t('views.users.form.password'), class: 'ls-row-option ls-row-option'
            =f.password_field :password, placeholder: 'at least 6 characters long', class: 'form-control ls-row-option-placeholder', id: 'user_password', required: true

        .col-sm-12
          .form-group
            =f.label :preferred_exam_body_id, 'Exam', class: 'ls-row-option'
            .input-group.input-group-lg
              =f.collection_select :preferred_exam_body_id, ExamBody.all_active.all_in_order, :id, :name, {include_blank: 'Choose an exam'}, {class: 'form-control ls-row-option-placeholder ls-down-arrow', id: 'user_exam_body', required: true}

      %fieldset.pt-2
        %legend.sr-only Terms and Conditions checkboxes
        .custom-control.custom-checkbox.mb-2
          %input{type: "checkbox", class: "custom-control-input", id: "terms_and_conditions", required: true}
          %label{class: "custom-control-label ls-row-checkbox", for: "terms_and_conditions"}
            I agree to learnsignal's
            =link_to 'terms and conditions', terms_and_conditions_url, target: '_blank', style: "color: #00b67b;"
        .custom-control.custom-checkbox.mb-2
          %input{type: "checkbox", class: "custom-control-input", id: "communication_approval", required: true}
          %label{class: "custom-control-label ls-row-checkbox", for: "communication_approval"}
            I agree to receiving communication from learnsignal

        .ls-mobile-adjust
          %p.pt-2{class: 'ls-disclaimer'}
            ="We're committed to your privacy. The information you provide is used to contact you about relevant content,
                products, and services. You may unsubscribe from these communications at any time. For more information,
                check out our"
            =link_to 'Privacy Policy.', privacy_policy_url, target: '_blank', style: "color: #00b67b;"

            .pt-0
              = hidden_field_tag :hutk
              = hidden_field_tag :page_uri
              = hidden_field_tag :page_name
              = hidden_field_tag :hs_form_id, Rails.application.credentials[Rails.env.to_sym][:hubspot][:form_api][:registration_form]
              .ls-row-login
                =f.submit 'Create Account', class: 'btn btn-gray ls-row-signup-btn', id: 'signUp'
            .sk-circle
              .sk-circle1.sk-child
              .sk-circle2.sk-child
              .sk-circle3.sk-child
              .sk-circle4.sk-child
              .sk-circle5.sk-child
              .sk-circle6.sk-child
              .sk-circle7.sk-child
              .sk-circle8.sk-child
              .sk-circle9.sk-child
              .sk-circle10.sk-child
              .sk-circle11.sk-child
              .sk-circle12.sk-child

:javascript
  function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  function nameStrSplit(fullNameEntry) {
    var firstName = fullNameEntry.split(" ").slice(0, -1).join(" ");
    var lastName = fullNameEntry.split(" ").slice(-1).join(" ");
  }

  function submitBtnActive() {
    if(
      $('#user_first_and_last_name').val().length > 0 && 
      $('#user_email').val().length > 0 && 
      $('#user_password').val().length > 0 && 
      $('#user_exam_body').val().length > 0 && 
      $('#terms_and_conditions').prop('checked') && 
      $('#communication_approval').prop('checked')) {
        $("#signUp").removeClass("btn-gray").addClass("btn-primary");
        console.log('Remove gray');
      } else {
        console.log('Remove primary');
        $("#signUp").removeClass("btn-primary").addClass("btn-gray");
      }
  }

  $(document).ready(function(){
    document.getElementById("hutk").value = getCookie("hubspotutk");
    document.getElementById("page_uri").value = document.URL;
    document.getElementById("page_name").value = document.title;
  });

  $(".sk-circle").hide();
  $("#new_user").submit(function(ev) {
    document.getElementById("hutk").value = getCookie("hubspotutk");
    ev.preventDefault();
    $("#signUp").hide();
    $(".sk-circle").show();
    this.submit();
  });

  $('#user_first_and_last_name').on('input', function(ev) {
    var fullNameEntry = $('#user_first_and_last_name').val();
    var firstName = fullNameEntry.split(" ").slice(0, -1).join(" ");
    var lastName = fullNameEntry.split(" ").slice(-1).join(" ");
    if (firstName === "") {
      firstName = lastName;
      lastName = "...";
    }
    document.getElementById("first_name").value = firstName;
    document.getElementById("last_name").value = lastName;
    submitBtnActive();
  });

  $('#user_email').on('input', function() {
    submitBtnActive();
  });

  $('#user_password').on('input', function() {
    submitBtnActive();
  });

  $('#user_exam_body').on('change', function() {
    submitBtnActive();
  });


  $('input[type="checkbox"]').on('change', function() {
    if($('#terms_and_conditions').prop('checked') == true) {
      $("#hidden_term_and_conditions").val('true');
    } else if($('#terms_and_conditions').prop('checked') == false) {
      $("#hidden_term_and_conditions").val('false');
    }
    submitBtnActive();
  });

  $('input[type="checkbox"]').on('change', function() {
    if($('#communication_approval').prop('checked') == true) {
      $("#hidden_communication_approval").val('true');
      gtag('event', 'agree_to_communication', {'event_category': 'pre-registration', 'event_label': 'register'});
    } else if($('#communication_approval').prop('checked') == false) {
      $("#hidden_communication_approval").val('false');
    }
    submitBtnActive();
  });
